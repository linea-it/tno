



Astrometry with the PRAIA package



    Here we refer as "field" to anything like a CCD frame, a digitized plate image,
etc. PRAIA stands for Plataform for Reduction of Astronomical Images Automatically.
It is based on source codes written entirely in standard fortran-77. PRAIA performs
precise astrometry, aperture and differential PSF photometry. Vast amounts of fields
are reduced very fast by PRAIA in a totally automatic fashion. Our astrometry group at Rio de
Janeiro is currently using PRAIA as its standard tool for photometric and astrometric reductions of
fields.

   In what follows, we show how to use PRAIA in its astrometric mode, including the meaning of
the content of the files generated. One should easely retrieve the resulting target astrometric info
from the reductions, as well as the measured (x,y)s and reference catalogue (RA,Dec)s and use them
on other astrometric reduction software or analysis packages, too.


   It is not our intention to explain here the astrometric (or photometric) concepts
of PRAIA. We only aim to give general guidelines so that the package can be readily used
and the results can be easly accessed for furhter analysis.


   Please ask for Marcelo Assafin (massaf@ov.ufrj.br) for further details about PRAIA.



 
The package



    The main astrometric core of PRAIA is currently comprised of the following fortran 77
codes and respective input data files:


PRAIA_header_extraction_11.f       PRAIA_header_extraction_11.dat
PRAIA_JPL_ephem_batch_2.f          PRAIA_JPL_ephem_batch_2.dat
PRAIA_targets_JPL_1.f              PRAIA_targets_JPL_1.dat
PRAIA_targets_skybot_1.f           PRAIA_targets_skybot_1.dat
PRAIA_astrometry_11.f              PRAIA_astrometry_11.dat
PRAIA_global_reduction_14.f        PRAIA_global_reduction_14.dat
PRAIA_targets_search_1.f           PRAIA_targets_search_1.dat




    Note that the name of the data files (except for the program PRAIA_astrometry_11) must be kept
unchanged.


Which program does what?


PRAIA_header_extraction_11                        : data extraction of fits images headers 
PRAIA_JPL_ephem_batch_2.f, PRAIA_targets_JPL_1.f  : JPL ephemeris generation
PRAIA_targets_skybot_1.f                          : SKYBOT (IMCCE) ephemeris generation
PRAIA_astrometry_11.f                             : astrometry of individual fields
PRAIA_global_reduction_14.f                       : astrometry of mosaic of fields
PRAIA_targets_search_1.f                          : finds targets within the output results, after
                                                    runing PRAIA_astrometry_11 or PRAIA_global_reduction_14


    To generate the executables, simply compile each fortran code. Example:


g77 -O3 -malign-double PRAIA_astrometry_11.f -o PRAIA_astrometry_11

on so on for each ".f" source file.



Reducing a field


    In what follows we will give the step by step procedure to reduce a fits image.
In our example we have the sample fits image:

                                   1013384p_10.fits

This image is one CCD out of the 36 CCDs from the CFHT/MegaCam CCD mosaic. According to
the header, the object observed in this mosaic field was asteroid 2006 SX368, so we will
assume in the example that our intention is to reduce the CCD image to make the astrometry
of 2006 SX368.

    In the tarball, I have included the input data files hereon referred to, as well as
all files generated by PRAIA in the reduction of the sample image. One shoud try to repeat
the procedures below and check the generated files with the ones furnished in the tarball.




Header Extraction


    The first step in the reduction is to extract the main info from the header of
the fits images. This is done with program PRAIA_header_extraction_11. First generate the list
of fits images:


            ls *.fits > list_fits_images


Then edit PRAIA_header_extraction_11.dat such as follows:


list_fits_images                                  | list of fits images for header extraction
header_extraction.dat                             | extracted data from fits images
6                                                 | fits header: 1=LNA,HP ; 2=ESO,SOAR (generic) ; 3=ESO/WFI ; 4=SOAR/SOI ; 5=SBIG-STL ; 6=CFHT/MegaCam


Note the "|" symbol: it clearly delimitates the 50 blank fields to fill the names of the files.
This sort of thing applies to all ".dat" of the PRAIA package. DO NOT change the column
position of "|" as weird things may occur with the file names. Please restrict the blank fields
ALWAYS to 50 columns.


   In the example above, the data from the headers will be written to "header_extraction.dat". Note
that any file name is valid here. However, the correct instrument/detector set must be furnished (in
our case, it is 6 = CFHT/MegaCam).


   After editing PRAIA_header_extraction_11.dat,  run


                    PRAIA_header_extraction_11



    Someting like this will be displayed:




                       PRAIA - Header extraction of fits files



               List of fits images to proccess                                     -> list_fits_images
               List of extracted fits fields                                       -> header_extraction.dat
               1 = LNA, HP ; 2 = ESO, SOAR (generic) ; 3 = ESO/WFI 4 = SOAR/SOI ; 5 = SBIG STL ; 6 = CFHT/MegaCam   ->  6


 Header extraction: image     1 of     1


  Proccess terminated. Status ok.




   The created file header_extraction.dat should look like this:

 21 19 27.7455 +16  1  4.896   9  1 22.21 2008  7 31  54678.37595153 2454678.87595153   130  g.MP9401              1013384p_10.fits                                   2006 SX368            2112  4644


It gives the (RA,DEC) of the center of the image, the instant of time in UT (hh,mm,ss,yr,month, day),
the MJD, the JD, exposure time (s), filter, fits file name, object name, CCD sizes (pixels).


   One can (and should) edit this file and correct any field if necessary, before continuing.

   Without this file one cannot continue with the PRAIA reductions. It is the first step in the whole
proccess. It is essencial that the info in this file is correct.





Preparing the Target List



  The target list of PRAIA is the list of astrometric coordinates of the targets. If the target file
is empty or simply doesn't exist, it will be ignored by PRAIA. It is a formated file and looks
like this:


 21 17 43.954200 +15 53 48.77500 2454678.87595153 2006_SX368


One have the coordinates and opitionally a Julian Date (JD) and a nickname for the targets. Note that
there can be any number of different targets in the file, or the same target may be listed many times
with different instants. If one have the same coordinates valid for any instant, put  JD = -1 in the
field (this is valid for fixed targets such as quasars for instance).


(note: again, column format is fixed)


  If it exists, PRAIA will read this file and search the astrometric results for the given targets.
The search is in 3-D: (RA,DEC,time). If JD=-1, the search is in 2-D: (RA,DEC) only. Then, after a positive
recognition of a target, the position offset in the sense "PRAIA-list" is archived in the appropriate
output file (see comments about output files at the appropriate section further on in the text).


    PRAIA can search the targets during, or after, the execution of its main astrometric programs:

 
              PRAIA_astrometry_11

              PRAIA_global_reduction_14 



    If one wishes to make the search later on, then one uses PRAIA_targets_search_1. To that, one
edits the respective input data file, PRAIA_targets_search_1.dat :

list_ucac_xy                                      | input file  : list of xy files from PRAIA reduction
target_2006_SX368      8                          | input file  : list of targets (movable or not, if any)
astrometry_UCAC2_total_sample                     | output file : log file with output of intermediary/main results from run
00.5000                                           | error radius (arcsec) for cross-identification of common stars among all xy fields
********************************************************************************************************************************************


Of course, the astrometric reduction must have been already performed. The files of kind "xy" must then
have already been obtained (see more comments about the "xy" output files later on the text).




Ephemeris extraction for preparing the Target list of solar system objects


   In the case of the moving objects of the solar system, PRAIA allows for the automatic generation of
the target file. One may select all objects on the field by using the SKYBOT facilities. Or one
can generate the ephemeris of a specific body in the field from JPL.


   In the case of SKYBOT, one must have an active internet connection. Edit PRAIA_targets_skybot_1.dat:


001                                               | start ephemeris extraction from nth file on the list
0.185                                             | pixel scale (arcsec/pixel)
568                                               | IAU Observatory code (511=Haute;874=LNA;568=Mauna Kea;500=geocentre, etc)
header_extraction.dat                             | file with extracted data from fits images
targets_cfht_sample                               | output skybot ephemerides for targets found


then run PRAIA_targets_skybot_1. Something like this should be displayed:




  


                       PRAIA automatic ephemeris extraction by SKYBOT



Input file with header extraction data         -> header_extraction.dat
Output file with targets ephemeris from SKYBOT -> targets_cfht_sample


 Removing temporary scratch files.



Image     1 of     1 -  Fits file 1013384p_10.fits



  Execution terminated succesfully.


After execution, the file "targets_cfht_sample" in the example should contain all solar system objects
in the CCD field. The "targets_cfht_sample" file is ready for use by PRAIA_astrometry_11 or
by PRAIA_global_reduction_14.



    In the case of JPL ephemeris extraction, a 2-step proccess is necessary. The first step is
to construct a batch file to be sent by email to the JPL server. The server then returns a JPL file.
The second step converts this JPL file into a PRAIA target file.


    In the first step, edit PRAIA_JPL_ephem_batch_2.dat:



01                                                | input file type: (1) - extracted headers .:. (2) - "xy" file list
header_extraction.dat                             | list of files with Julian date for JPL ephemeris extraction
2006_sx368                                        | root name for JPL ephemeris extraction batch file
568@399                                           | IAU observer code for JPL ephemeris extraction
DES=2006 SX368                                    | IAU body code for JPL ephemeris extraction batch file


(obs1:note option "02" related to the "xy" files, if you are preparing the target list AFTER running
PRAIA astrometric module).

(obs2: avoid blanck fields in the root name for JPL ephemeris extraction batch file, as that might cause
weird effects in the generated file names)



  Then run PRAIA_JPL_ephem_batch_2. One should get something like this on the screen:




        PRAIA JPL batch generator


  Input data:
  01                                                | input file type: (1) - extracted headers .:. (2) - "xy" file list
  header_extraction.dat                             | list of files with Julian date for JPL ephemeris extraction
  2006_sx368                                        | root name for JPL ephemeris extraction batch file
  568@399                                           | IAU observer code for JPL ephemeris extraction
  DES=2006 SX368                                    | IAU body code for JPL ephemeris extraction batch file


 Produced JPL batches ->  1 file(s):

 2006_sx368_00001



  Execution terminated succesfully.



  File "2006_sx368_00001" has been created. It looks like this:


!$$SOF
   EMAIL_ADDR = ' '
   COMMAND    = 'DES=2006 SX368'
   OBJ_DATA   = 'NO'
   MAKE_EPHEM = 'YES'
   TABLE_TYPE = 'OBS'
   CENTER     = '568@399'
   REF_PLANE  = 'BODY EQUATOR'
   COORD_TYPE  = 'GEODETIC'
   TLIST=
        '2454678.87595153'
   QUANTITIES = '1,9,10'
   REF_SYSTEM = 'J2000'
   CAL_FORMAT = 'CAL'
   ANG_FORMAT = 'HMS'
   APPARENT   = 'AIRLESS'
   TIME_DIGITS = 'FRACSEC'
   TIME_ZONE   = '+00:00'
   ELEV_CUT   = '0'
   SKIP_DAYLT = 'YES'
   SOLAR_ELONG= '0,180'
   EXTRA_PREC = 'YES'
   CSV_FORMAT = 'NO'
   VEC_LABELS = 'NO'
   ELM_LABELS = 'NO'
   R_T_S_ONLY = 'NO'
   CA_TABLE_TYPE= 'STANDARD'
!$$EOF


 Note that the instants of observation are extracted from the "header_extraction.dat" file.



 One comment here. Supose there were 300 images. Then, 2 batch files would have been created:


 ...

 Produced JPL batches ->  2 file(s):

 2006_sx368_00001
 2006_sx368_00002


 In general, multiple batch files may be created according to the number of images. This is because
JPL accepts batches with up to 200 entries only at a time. In that case, each created batch file must
be separately sent by email to the JPL server.
 

  In our example, we have only one file to send:


  mailx horizons@ssd.jpl.nasa.gov -r myself@myself.com -s JOB -a 2006_sx368_00001


where myself@myself.com is our user email account.


 Then the user should expect JPL to return an email like this:


Automated mail xmit by MAIL_REQUEST, PID=   29832 Fri Sep 26 20:25:53 2008
++++++++++++++++++++++++++++++++ (part 1 of 1)  +++++++++++++++++++++++++++++++



*******************************************************************************
Ephemeris / MAIL_REQUEST Fri Sep 26 20:25:53 2008  Pasadena, USA / Horizons
*******************************************************************************
Target body name: (2006 SX368)                    {source: MP143269}
Center body name: Earth (399)                     {source: DE405}
Center-site name: Mauna Kea
*******************************************************************************
Start time      : A.D. 2008-Jul-31 09:01:22.2120 UT
Stop  time      : A.D. 2008-Jul-31 09:01:22.2120 UT
Step-size       : DISCRETE TIME-LIST
*******************************************************************************
Target pole/equ : No model available
Target radii    : (unavailable)
Center geodetic : 204.527800,19.8261152,4.2078485 {E-lon(deg),Lat(deg),Alt(km)}
Center cylindric: 204.527800,6006.35451,2151.0229 {E-lon(deg),Dxy(km),Dz(km)}
Center pole/equ : High-precision EOP model        {East-longitude +}
Center radii    : 6378.1 x 6378.1 x 6356.8 km     {Equator, meridian, pole}
Target primary  : Sun                             {source: DE405}
Interfering body: MOON (Req= 1737.400) km         {source: DE405}
Deflecting body : Sun, EARTH                      {source: DE405}
Deflecting GMs  : 1.3271E+11, 3.9860E+05 km^3/s^2
Small perturbers: Ceres, Pallas, Vesta            {source: SB405-CPV-2}
Small body GMs  : 6.32E+01, 1.43E+01, 1.78E+01 km^3/s^2
Atmos refraction: NO (AIRLESS)
RA format       : HMS
Time format     : CAL
EOP file        : eop.080926.p081218
EOP coverage    : DATA-BASED 1962-JAN-20 TO 2008-SEP-26. PREDICTS-> 2008-DEC-17
Units conversion: 1 AU= 149597870.691 km, c= 299792.458 km/s, 1 day= 86400.0 s
Table cut-offs 1: Elevation (  0.0deg=YES),Airmass (>38.000=NO), Daylight (YES)
Table cut-offs 2: Solar Elongation (  0.0,180.0=NO )
*******************************************************************************
Initial FK5/J2000.0 heliocentric ecliptic osculating elements (AU, DAYS, DEG):
 EPOCH=  2454800.5 ! 2008-Nov-30.00 (CT)         RMSW= n.a.
   EC= .4623592           QR= 11.9622054         TP= 2455333.9533025
   OM= 280.00109          W= 70.52731            IN= 36.27547
Asteroid physical parameters (KM, SEC, rotational period in hours):
   GM= n.a.               RAD= n.a.              ROTPER= n.a.
   H= 9.5                 G= .150                B-V= n.a.
                          ALBEDO= n.a.           STYP= n.a.
*******************************************************************************
 Date__(UT)__HR:MN:SC.fff     R.A.___(ICRF/J2000.0)___DEC  APmag   Illu%
************************************************************************
$$SOE
 2008-Jul-31 09:01:22.212     21 17 43.9542 +15 53 48.775  20.48  99.942
$$EOE
*******************************************************************************
Column meaning:

TIME

 Prior to 1962, times are UT1. Dates thereafter are UTC. Any 'b' symbol in
the 1st-column denotes a B.C. date. First-column blank (" ") denotes an A.D.
date. Calendar dates prior to 1582-Oct-15 are in the Julian calendar system.
Later calendar dates are in the Gregorian system.

 The uniform Coordinate Time scale is used internally. Conversion between
CT and the selected non-uniform UT output scale has not been determined for
UTC times after the next July or January 1st.  The last known leap-second
is used over any future interval.

 NOTE: "n.a." in output means quantity "not available" at the print-time.

 (...)




  Copy and paste the email into a file, say "JPL_2006_SX368". Then edit PRAIA_targets_JPL_1.dat:


2006_SX368                                        | target name for output results with PRAIA
JPL_2006_SX368                                    | input JPL-generated ephemerides for target
target_2006_SX368                                 | output JPL ephemerides for target in PRAIA format



  Finally, run PRAIA_targets_JPL_1:





                       PRAIA: JPL Ephemeris to Targets





               JPL ephemeris data file                    -> JPL_2006_SX368
               PRAIA output target file                   -> target_2006_SX368


  Execution terminated ok.




  That is it. The target file "target_2006_SX368" has been created and is ready to use.



Single field astrometric reductions


  Let's start with the astrometric reduction of single fields. After that, we will see how to
reduce mosaics of CCDs (overlapping).

  Briefely speaking, PRAIA performs automatic astrometric reductions of fields. It automatically 
identifies objects in the CCD image and then fits 2-D symetric Gaussians to these objects,  within 1 FWHM
of radius. Then it automatically identifies among these objects the stars from the reference catalogs.

  Two reference catalogs are used: 2MASS and UCAC2. In the case of 2MASS, 3 sets of positions are
computed: 2MASS in original form, 2MASS corrected toward the UCAC2 by the tangent plane techinique
(Assafin et al 1997, AJ) and this 2MASS further corrected by UCAC2 proper motions. Thus, a total of 4
sets of positions are actually generated for any object on the fields. Magnitudes (PSF photometry) are
also computed in the UCAC2 system. 
 

  To make the astrometric reduction of single images, one uses program PRAIA_astrometry_11. Following our
example, let's reduce image 1013384p_10.fits. The extracted header info is in file header_extraction.dat
and the target file is target_2006_SX368.


  Edit the PRAIA_astrometry_11.dat :


/home/marcelo/2MASS/2MASS/                        | root directory under which the 2MASS catalogue sub-directories lay
/home/marcelo/UCAC2/UCAC2/                        | root directory under which the UCAC2 catalogue sub-directories lay
header_extraction.dat                             | extracted header data from fits images
target_2006_SX368                                 | targets input file: (RA,Dec), JD, target name
astrometry_photometry_sample                      | photometric statistics of each field
astrometry_reduction_2m_sample                    | reduction statistics of each field for UCAC2 and 2MASS (original)
astrometry_reduction_mp_sample                    | reduction statistics of each field for UCAC2 and 2MASS (t.p.+common p.m.)
astrometry_reduction_mp_med_sample                | reduction statistics of each field for UCAC2 and 2MASS (t.p.+common and non-common p.m.)
astrometry_2MASS_total_sample                     | target complete statistics for 2MASS (original)
astrometry_2MASS_summary_sample                   | target summary  statistics for 2MASS (original)
astrometry_UCAC2_total_sample                     | target complete statistics for UCAC2
astrometry_UCAC2_summary_sample                   | target summary  statistics for UCAC2
astrometry_2MASS_mp_total_sample                  | target complete statistics for 2MASS (t.p.+common p.m.)
astrometry_2MASS_mp_summary_sample                | target summary  statistics for 2MASS (t.p.+common p.m.)
astrometry_2MASS_mp_med_total_sample              | target complete statistics for 2MASS (t.p.+common and non-common p.m.)
astrometry_2MASS_mp_med_summary_sample            | target summary  statistics for 2MASS (t.p.+common and non-common p.m.)
ucac2.red.xy                                      | extension of "xy" output files, UCAC2 reduction
2mass.red.xy                                      | extension of "xy" output files  2MASS reduction
2mass.rmp.xy                                      | extension of "xy" output files  2MASS (t.p.+common p.m.) reduction
2mass.rme.xy                                      | extension of "xy" output files  2MASS (t.p.+common and non-common p.m.) reduction
2     0   0   0      0   0   0                    | field area for tp+pm reduction (key,dg,min,arcsec): key=1-2 CCD size;  key=0 areax=dg,m,s areay=dg,m,s
42                                                | maximum number of non-common 2MASS stars for (t.p.+common and non-common p.m.) reduction
01.0                                              | error radius for target identification (arcsec)
0.1850                                            | pixel scale (arcsec/pixel)
0.001                                             | +/- error of pixel scale (arcsec/pixel)
1                                                 | 1 - automatic reference catalog (RA,DEC) vs. (x,y) identification  ;  2 - semi-automatic identification
2 000 0.1                                         | semi-automatic id: xy (1=direct, 2=indirect, 3=automatic) , rotation angle (dg), +/- angle error (dg)
60000                                             | ADU maximum counting cutoff for non-linear pixels (~saturation) (ex.: 32000, 65000, ...)
+0000                                             | ADU minimum counting cutoff for non-linear pixels (~sky background) (ex.: -10, 0 , ...)
0                                                 | Pixel physical counts: 0 = from image header or 1 = from user (here)
1.0d0                                             | Pixel physical counts: bscale;  Pixel = bscale * matrix + bzero
0.0d0                                             | Pixel physical counts: bzero ;  Pixel = bscale * matrix + bzero
0                                                 | litteendian x bigendian: byte-swap (0 = automatic; 1 = don't swap ; 2 = swap bytes)
5                                                 | N for smoothing filter of (2N+1) channels in sky background computations (0 = no filter) (suggestion: N=5)
0002.50                                           | sky background theshold factor: theshold = sky + FACTOR * sigma (objects ID)
0.5  05.0                                         | minimum maximum FWHM (range of FWHMs) (objects ID)
0700                                              | brightest 2MASS stars for cross-identification with brightest measured (x,y) objects
30                                                | brightest measured (x,y) objects for cross-identification with brightest 2MASS stars
00.5000                                           | error radius (arcsec) for cross-identification between brightest catalogue/measured objs
0.200                                             | (O-C) cutoff for outliers in (RA,DEC) reductions with 2MASS (original)
0.120                                             | (O-C) cutoff for outliers in (RA,DEC) reductions with UCAC2 & 2MASS corrected version
2                                                 | polynomial (x,y) <-> (X,Y) in (RA,DEC) reductions: 0 = 4 Ctes; 1 to 3 = complete order
0                                                 | radial distortion of 3rd order (x,y) <-> (X,Y) in (RA,DEC) reduction: 0 = no; 3 = yes
0                                                 | radial distortion of 5th order (x,y) <-> (X,Y) in (RA,DEC) reduction: 0 = no; 5 = yes
00 00                                             | range of fits images to reduce from extracted header data file



   In short, here one is identifying objects within 0.5 and 5 arcsec of FWHM (the accepted range of seeing)
and is reducing the (RA,DEC) using a complete polynom of degree 2. We decline from commenting each line
in this file in detail, since each entry should be self-explanatory. There should be no difficulties in
performing the reductions using this set of values for the CCDs from the CFHT/MegaCam. Note that most of
these values apply to a large range of detectors/instruments. Of course, for getting used with PRAIA, it is
healthy to try different sets of values and then evaluate the changes on performance and on the results.




   After editing the input data file PRAIA_astrometry_11.dat, then simply run:



      PRAIA_astrometry_11 < PRAIA_astrometry_11.dat > logfile


This produces a logfile containing extra info about the reductions as PRAIA runs. Otherwise



      PRAIA_astrometry_11 < PRAIA_astrometry_11.dat 



will output the extra info on screen.



   One should note that one can make any number of different input data files like PRAIA_astrometry_11.dat
with different names and run PRAIA_astrometry_11 on each one simultaneously. Even from the same directory.
Even on the same set of images. PRAIA_astrometry_11 is the only program of the PRAIA package which allows
this.


   On a multicore processor, multiple PRAIA_astrometry_11 runs do not slow down the speed of the
proccessing. To optimize reduction time, one should run as much PRAIA proccesses as one could. In the
present example, it takes about 2 minutes for PRAIA to reduce the 2112 x 4644 1013384p_10.fits array with an
Intel 2.4 GHz processor.


   Just one or two notes. First, we have used here a 2nd degree polynomial model:


2                                                 | polynomial (x,y) <-> (X,Y) in (RA,DEC) reductions: 0 = 4



   This is not necessarily the best astrometric choice for the given image. One should try 1, 2 and 3
degrees. Probably the best fit will come from the use of a 3rd degree polynom. However, since only about
14 UCAC2 stars were present on the field, there was no much of a choice. Of course this is no problem for
the 2MASS results, as there are too many stars available.


   No external packages (such as QFITS) are any longer needed to run PRAIA. PRAIA can now read
straightfowardly integer or floating point fits files. It also can now automatically deal with
litteendian x bigendian number formats (byte swap issues *).


* note: there can still be cases in which a hand-made choice of litteendian x bigendian is necessary; in
that case, the user can choose the proper set:

1                                                 | litteendian x bigendian: byte-swap (0 = automatic; 1 = don't swap ; 2 = swap bytes)


or

2                                                 | litteendian x bigendian: byte-swap (0 = automatic; 1 = don't swap ; 2 = swap bytes)






   The output files with the results will be described further ahead.




Astrometric reductions of mosaics


   

   Take, for example, the complete set of CCDs obtained from a single CFHT/MegaCam shoot. Supose now
that many such exposures were made in an overlapping fashion such that a number of mosaics of CCDs were
superinposed, so that a given area of the sky has been covered by diferent CCDs from different mosaic
exposures.

   PRAIA performs the global reduction technique to solve for the astrometric positions of stars/objects
observed in such mosaics of CCDs. The reduction is automatic and very fast. It is made in 2 steps.

   The first step consists in runing PRAIA on all the single CCDs from all observed mosaics. This is
done by runing the program PRAIA_astrometry_11 over the CCDs exactly as described before.

   
   The second step performs the global reduction technique proper. It takes the solutions of the
single frames from the first step as a starting point and then continues to solve the mosaics in a
iterative procedure. The procedure is such that the entire region of the sky covered by the mosaics is
progressivelly put into a more and more rigid instrumental system aligned as a whole to the UCAC2.
The final result is a coherent set of positions from a large area of the sky practically unnafected by
zero-point errors from the reference catalog (the UCAC2 in the case).


   Thus, the first step is runing PRAIA_astrometry_11 and performing the single field astrometry.  
For the 2nd step, edit PRAIA_global_reduction_14.dat :


/home/marcelo/UCAC2/UCAC2/                        | root directory under which the UCAC2 catalogue sub-directories lay
list_xy                                           | input file  : list of xy files from PRAIA reduction
targets                                           | input file  : list of targets (moving or not, if any)
1                                                 | exclude individual target positions from global reduction proccess? (recomended for moving targets)  1=Yes, 2=No
logfile                                           | output file : log file with output of intermediary/main results from run
catalog                                           | output file : final "xy" catalog with all stars from global reduction
targ_cat_global_reduction                         | output file : target output results from global reduction position catalog
targ_cat_single_reduction                         | output file : target output results from single xy re-reduced fields
ucac2.grd.xy                                      | extention of xy output files from final global reductions (12 characters!!)
2                                                 | Global reduction final step: (RA,DEC) -> UCAC2   1 = rigid rotation  2 = tangent plane techinique
0.400                                             | error radius (arcsec) for cross-identification of common stars among all xy fields
1.000                                             | error radius (arcsec) for cross-identification of targets within all xy fields
0.500                                             | error radius (arcsec) for cross-identification of UCAC2 stars with "averaged" field star positions
0.400                                             | (O-C) cutoff for outliers in (RA,DEC) individual CCD reductions (arcsec)
0.120                                             | (O-C) cutoff for outliers in (RA,DEC) transform towards the UCAC2 (arcsec)
0.0002                                            | sigma of convergence between old/new positions in (RA,DEC) re-reductions iter. proccess
200                                               | Maximum No. of global reduction iterations
3                                                 | polynomial (x,y) <-> (X,Y) in FRAME (RA,DEC) reductions: 0 = 4 Ctes; 1 to 3 = complete order
0                                                 | radial distortion of 3rd order (x,y) <-> (X,Y) in (RA,DEC) reduction: 0 = no; 3 = yes  (FRAMES)
0                                                 | radial distortion of 5th order (x,y) <-> (X,Y) in (RA,DEC) reduction: 0 = no; 5 = yes  (FRAMES)
3                                                 | polynomial (x,y) <-> (X,Y) in (RA,DEC) (tangent plane reductions only) : 0 = 4 Ctes; 1 to 3 = complete order
0                                                 | radial distortion of 3rd order (x,y) <-> (X,Y) in (RA,DEC) reduction: 0 = no; 3 = yes  (tan. plane reds. only)
0                                                 | radial distortion of 5th order (x,y) <-> (X,Y) in (RA,DEC) reduction: 0 = no; 5 = yes  (tan. plane reds. only)




where list_xy is the list of "xy" files which are the output from the PRAIA_astrometry_11 run. Practice
says that using the "xy" files from the "2MASS original" solution as a starting point is generally the best
choice.


  After editing the input file, simply run PRAIA_global_reduction_14.


  Intermediary and final astrometric info are displayed on screen and is also stored in the logfile.


  The resulting output files from PRAIA_global_reduction_14 have the same format and meaning as those
from single field reductions with PRAIA_astrometry_11.





(note: no practicall example of the use of PRAIA_global_reduction_14 can be shown here for there is just
1 CCD image from the CFHT mosaic in our example)






Overview about PRAIA astrometric output files




    After reductions, PRAIA_astrometry_11 generates two kinds of astrometric files:
general results files and (field) individual results files. In the case of general files,
each entry regards one field. For the individual files, each entry regards an object in an
individual field. Here, we will furnish the collumn formats to read the data for all
these astrometric files.


    Below we list an example with all general files produced by PRAIA and their
meaning for the sample fits image 1013384p_10.fits of our example. This
image is one CCD out of the 36 CCDs from the CFHT/MegaCam CCD mosaic. According to
the header, the object observed in this mosaic field was asteroid 2006 SX368.



    After runing PRAIA_astrometry_11 in the above example, one should get the following
output files:


astrometry_UCAC2_total_sample:

    Gives detailed astrometric and photometric information from UCAC2 reductions for the
target, including the position offsets of asteroid 2006 SX368 in the sense
"CCD minus JPL ephemeris", the (x,y) location in the CCD frame, magnitude, FWHM, errors, etc.


(note: the file in this example is empty since no asteroid is present in this specific CCD in the mosaic!)




astrometry_UCAC2_summary_sample:


   Same thing, but with less information.




astrometry_2MASS_total_sample, astrometry_2MASS_mp_total_sample, astrometry_2MASS_mp_med_total_sample:


    Same as astrometry_UCAC2_total_sample, but regarding 2MASS reductions, in the sense:

2MASS  - original 2MASS
mp     - 2MASS corrected toward the UCAC2 by the tangent plane technique (Assafin et al 1997, AJ)
mp_med - 2MASS corrected toward the UCAC2 by the tangent plane technique plus using the UCAC2
         proper motion distribution



astrometry_2MASS_summary_sample, astrometry_2MASS_mp_summary_sample, astrometry_2MASS_mp_med_summary_sample:

   Same thing, but with less information.




astrometry_reduction_2m_sample, astrometry_reduction_mp_sample, astrometry_reduction_mp_med_sample:


   Gives general astrometric information for each field, regarding mainly the (RA,DEC)
reductions using UCAC2 and 2MASS (original, "mp" or "mp_med" as designated before). All this general
field information is nevertheless also present in the respective "total" files. 



astrometry_photometry_sample:

   Field information regarding the PSF photometry for all stars in the field, including
average seeing estimates and errors.



   All the above files are produced in the same working directory from which PRAIA is run.


   Now we give examples of individual field files. They are produced exactly in the directories
were the fits files are located. In our example, the fits image is placed in the current working
directory "./". After running PRAIA, one should find:


1013384p_10.fits           - the fits image

1013384p_10.reg            - SAOimage region file (within ds9, set region format "old SAOimage"),
                             to look at the identified objects in the field; boxes correspond
                             to the 2-D Gaussian fitted area f the object

1013384p_10.2mass.red.xy   - (x,y) of all measured objects in the field, (RA,DEC) reduction
                             information (reference catalogue = original 2MASS) 

1013384p_10.2mass.rmp.xy   - same as before, but reference catalogue = 2MASS corrected toward UCAC2
                             only by the tangent plane technique.

1013384p_10.2mass.rme.xy   - same as before, but reference catalogue = 2MASS further corrected by
                             UCAC2, using the tangent plane technique plus proper motion correction
                             to all non-common 2MASS stars

1013384p_10.ucac2.red.xy   - the same, with UCAC2 as the reference catalogue
 
    

    One can easely retrieve the measured (x,y)s and reference catalogue (RA,Dec)s from
files "xy". The (x,y) are directly given. The reference catalogue (RA,DEC) positions for
the CCD epoch (ie, corrected by proper motions) can be derived from the given observed
(RA,Dec) reference star position and from the listed (O-C) residuals for each coordinate
(see more tips about this below). This also holds for retrieving the star positions of the
2MASS corrected versions.   





Output File Formats



   The seeing estimated for the entire field comes from histogram statistics from the FWHM of 
the field stars (FWHM are individually given for each field star in the "xy" files). They can be
easely retrieved for each field from the "photometry" files (1rst and 2nd columns give
respectivelly the seeing and the standard-deviation in arcsecs, one field per line). 


   Below, we give the file formats for the most important files which give the astrometric results.
These are files "total" and "xy" (see comments on the examples above). As a matter of fact, the
"total" file format and the "xy" file format are virtually identical, except that the first two
columns in file "total" are, for obvious reasons, not present on the "xy" files. One should easely
understand the meanings of the cited values below for files "total" which contains
target information for each field. For retrieving the format of files "xy" (individual stars in
a field) just drop the first 2 collumns.


   The formats below are identical for the output files generated  with PRAIA_astrometry_11 or
PRAIA_global_reduction_14.



Read format (identical for 2MASS* reductions and UCAC2 reductions):


      read dx,dy,xob,yob,seng,altu,fgcc,fumag,fumag2,
     ?xmgu,cudmg,cudmg2,xmgj,xmgh,xmgk,res2mg,resmg2,ermgj,ermgh,
     ?ermgk,pma,pmd,epma,epmd,ex,ey,erau,edeu,alfsiu,delsiu,
     ?nstaru,nfinau,alsiu,desiu,ktirau,ra,de,iuth,iutm,sut,iutano,
     ?iutmes,iutdia,dj,iexps,ichfil,infits,iobalv,nx,ny


      format(2(1x,f5.3),2f9.3,2(1x,f7.3),2(1x,f7.2),1x,f5.3,2(1x,f9.2),13(1x,f6.3),
     ?4(1x,f7.3),6(1x,f6.3),2(1x,i4),2(1x,f6.3),1x,i4,2(1x,f13.9),1x,
     ?i2,1x,i2,1x,f5.2,1x,i4,1x,i2,1x,i2,1x,f16.8,2x,i4,2x,a20,2x,a50,
     ?1x,a20,2(1x,i5))



Note-1: Cols 03 and 04 are the measured (x,y)s 
Note-2: Cols 33, 34, 36, 37 allows retrieving the used reference catalogue (RA,DEC)s
Note-3: Be aware that Cols 01 and 02 below are only present on files "total" - THEY
        DO NOT EXIST on "xy" FILES! Avoid column numbering mis-readings!


***********************************************************************************

col 01 dx     = CCD minus ephemeris for RA  (arcsec)

col 02 dy     = CCD minus ephemeris for Dec  (arcsec)

col 03 xob    =  x on CCD (Circular Gaussian) in pixels

col 04 yob    =  y on CCD (Circular Gaussian) in pixels

col 05 seng   = computed star FWHM (arcsec)

col 06 altu   = Gaussian peak (CCD counting units)

col 07 fgcc   = sky background in the vicinity of the object, derived from the
                Gaussian adjustment

col 08 fumag  = sky background magnitude based in UCAC2 star magnitudes,

col 09 fumag2 = sky background magnitude based in 2MASS star J magnitudes,
                converted to UCAC2 magnitudes by common 2MASS/UCAC2 stars

col 10 xmgu   = UCAC2 star magnitude (if UCAC2 star)
                
col 11 cudmg  = object magnitude based in UCAC2 star magnitudes (PSF photometry)

col 12 cudmg2 = object magnitude as in col 09

col 13 xmgj   = J magnitude 2MASS (if 2MASS star)

col 14 xmgj   = H magnitude 2MASS (if 2MASS star)

col 15 xmgj   = K magnitude 2MASS (if 2MASS star)

col 16 res2mg = error of object magnitude (UCAC2-based) 

col 17 resmg2 = error of object magnitude (2MASS/UCAC2-based as in col 09) 

col 18 ermgj  = J magnitude error from 2MASS

col 19 ermgh  = H magnitude error from 2MASS

col 20 ermgk  = K magnitude error from 2MASS

col 21 pma    = UCAC2 proper motion (RA) (arcsec/year)
                (99.999 if not an UCAC2 star)

col 22 pmd    = UCAC2 proper motion (Dec) (arcsec/year)
                (99.999 if not an UCAC2 star)

col 23 epma   = UCAC2 proper motion error (RA) (arcsec/year)

col 24 epmd   = UCAC2 proper motion error (Dec) (arcsec/year)

col 25 ex     = Gaussian error in (x) (arcsec)

col 26 ey     = Gaussian error in (y) (arcsec)

col 27 erau   = standard error (RA) (arcsec) from variance-covariance matrix of (RA,DEC)
                least squares reduction for the (x,y) of object, rigorously computed
                (Eichorn & Willians, AJ, 1963)

col 28 edeu   = same as before for DEC (arcsec)
       

col 29 alfsiu = mean error (RA) (arcsec) from (RA,Dec) reductions
                (i.e., standard-deviation from the (O-C) residuals
                for the reference catalogues)

col 30 delsiu = same as above for DEC (arcsec)

col 31 nstaru = number of identified reference catalogue stars on the field

col 32 nfinau = number of used reference catalogue stars in reduction
                (elimination of about 10% stars with highest (O-C) residuals)


col 33 alsiu  = (O-C) (arcsec) for RA (99.999 if target is not a reference star)

col 34 desiu  = (O-C) (arcsec) for DEC (99.999 if target is not a reference star)

col 35 ktirau = - 0 if target is a reference catalogue star mantained  in the (RA,DEC) reductions
                - 1 if target is a reference catalogue star eliminated in the (RA,DEC) reductions
                  (the (O-C) is computed anyway)
                - 99 target is not a reference catalogue star

col 36 ra     = target CCD right ascension (RA) (hours and fraction)
                (if target is a reference star, the RA catalogue position can be retrieved
                 using the (O-C), ie, RA_ref_cat = ra - alsiu

col 37 de     = target CCD declination  (DEC) (degrees and fraction)
                (if target is a reference star, the DEC catalogue position can be retrieved
                 using the (O-C), ie, DEC_ref_cat = de - desiu 


col 38 iuth   = UT instant of exposition (hours)

col 39 iutm   = UT instant of exposition (minutes)

col 40 sut    = UT instant of exposition (seconds)

col 41 iutano = Gregorian date of exposition (year)

col 42 iutmes = Gregorian date of exposition (month)

col 43 iutdia = Gregorian date of exposition (day)

col 44 dj     = Julian Date of exposition

col 45 iexps  = exposure time in seconds

col 46 ichfil = used filter

col 47 infits = image fits file from which target position is derived

col 48 mchobj = target name or alias

col 49, 50 nx, ny = CCD or field size in pixels in x and y


***********************************************************************************

